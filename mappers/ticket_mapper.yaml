# 获取所有监控中的票档信息
get_all_ticket_items: >
  SELECT * FROM ticket_items 
  ORDER BY sale_start_time ASC, updated_at DESC


# 搜索唯一的项目标题（用于下拉菜单展示）
search_projects: >
  SELECT 
    item_id, 
    project_title, 
    venue_name, 
    MIN(perform_time) as start_time
  FROM ticket_items
  WHERE 
  (%(keyword)s = '' OR project_title LIKE CONCAT('%%', %(keyword)s, '%%'))
  GROUP BY item_id, project_title, venue_name
  ORDER BY start_time DESC
  LIMIT 10

# 获取该演出的所有明细
get_project_details: >
  SELECT * FROM ticket_items 
  WHERE item_id = %(item_id)s 
  ORDER BY perform_time ASC, price ASC
  
# 批量更新 SKU 库存信息
upsert_ticket_item: >
  INSERT INTO ticket_items (
    item_id, project_title, venue_name, perform_id, perform_time, 
    sku_id, price_name, price, stock_status, limit_quantity, 
    sale_start_time, updated_at
  ) VALUES (
    %(item_id)s, %(project_title)s, %(venue_name)s, %(perform_id)s, %(perform_time)s, 
    %(sku_id)s, %(price_name)s, %(price)s, %(stock_status)s, %(limit_quantity)s, 
    %(sale_start_time)s, NOW()
  )
  ON DUPLICATE KEY UPDATE 
    stock_status = VALUES(stock_status),
    price = VALUES(price),
    updated_at = NO

# 批量更新 SKU 库存信息
upsert_ticket_item: >
  INSERT INTO ticket_items (
    item_id, project_title, venue_name, perform_id, perform_time, 
    sku_id, price_name, price, stock_status, limit_quantity, 
    sale_start_time, updated_at
  ) VALUES (
    %(item_id)s, %(project_title)s, %(venue_name)s, %(perform_id)s, %(perform_time)s, 
    %(sku_id)s, %(price_name)s, %(price)s, %(stock_status)s, %(limit_quantity)s, 
    %(sale_start_time)s, NOW()
  )
  ON DUPLICATE KEY UPDATE 
    stock_status = VALUES(stock_status),
    price = VALUES(price),
    updated_at = NOW()

